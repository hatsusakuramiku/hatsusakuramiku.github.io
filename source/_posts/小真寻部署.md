---
title: 【zhenxun_bot】 可爱的绪山真寻Bot部署教程
cover: 'https://cdn.hatsusakuramiku.cn/hexo/img/gallery/post/81677882.webp'
top_img: 'https://cdn.hatsusakuramiku.cn/hexo/img/gallery/post/81677882.webp'
tag:
    - 学习
category: zhenxun_bot
swiper_index: 1
description: 在windows与云服务器等平台部署zhenxun_bot的简单教程
abbrlink: a6416c9d
date: 2022-09-10 17:48:00
---
{% note warning flat %}
注意，本文正在完善中，或有不正确的地方！！！
{% endnote %}

>**zhenxun_bot相关导航**
>
>1. [【zhenxun_bot】可爱的绪山真寻Bot部署教程](/posts/a6416c9d.html)⇦当前位置🪂

{% note info flat %}封面图片PID:[81677882](https://www.pixiv.net/artworks/81677882){% endnote %}

{% note warning flat %}阅前须知：本教程与此项目仅用于学习交流，不存在任何盈利目的，请勿用于非法或盈利用途！！！{% endnote %}
![小真寻](https://cdn.hatsusakuramiku.cn/hexo/img/gallery/post/zhenxun.png "xiaozhenxun")

目前已实现的功能
![功能介绍](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/opionts.png "opionts")
关于[小真寻](https://zh.moegirl.org.cn/%E7%BB%AA%E5%B1%B1%E7%9C%9F%E5%AF%BB)（[绪山真寻](https://zh.moegirl.org.cn/%E7%BB%AA%E5%B1%B1%E7%9C%9F%E5%AF%BB)）
更多更详细的介绍请移步:[[使用文档]](https://hibikier.github.io/zhenxun_bot/blogs/about.html)|[[项目地址]](https://hibikier.github.io/zhenxun_bot/blogs/about.html)

## 注意事项

1. 保证系统的相同，环境的相同，是尽量减少麻烦的最有效的途径
2. 遇到麻烦先不要慌，先看看你是不是漏看了亿步
3. 实在解决不了，带上你的完整的报错，和自己所做过的行为去群里问问。QQ群：[是真寻酱哒](https://jq.qq.com/?_wv=1027&k=u8PgBkMZ)

## 必要的准备

1. 一定的基础，包括但不限于稍微熟悉linux或windows cmd命令行
2. 一台还凑合的{% span red, 电脑或云服务器 %}，推荐部署系统: [Ubuntu20.04 LTS](https://cn.ubuntu.com/blog/ubuntu-20-04-lts-arrives-cn)
3. 一个可以用的脑子
4. 善于百度谷歌的双手

## 简要说明

{% note warning flat %}
因为腾讯对第三方QQbot的封杀，go-cqhttp近乎无法使用，本教程已弃用go-cqhttp，不过可以使用其他无头QQ如[NapCat](https://napneko.github.io/zh-CN/),[LLOneBot](https://github.com/LLOneBot/LLOneBot)等
{% endnote %}
一个基于{% span red, Nonebot2 %}  和 {% span red, go-cqhttp %} 开发，以 {% span red, PostgreSQL %} 作为数据库的可爱Bot，推荐在linux部署。本教程将介绍如何在windows {% span red, powershell %}命令行，{% span red, WSL %}，云服务器，本地{% span red, VMware %} 搭建服务器等环境部署{% span red, zhenxun_bot %} 。

## 一、在windows {% span red, powershell %} 命令行部署

{% folding blue, 部署教程 %}

### 1.1 必要环境

这一步主要安装{% span red, git %}与{% span red, python %}，要求{% span red, python %}版本为{% span red, 3.8.x %}及以上

{% note success no-icon %}
首先回到桌面，按下 {% nota 快捷键 , Windows键就是有微软徽标的键 %}{% kbd Windows %} + {% kbd R %} ,在弹出的窗口中键入\```powershell\```并按 {% kbd ENTER %} 键打开 {% span red, powershell %} 窗口。
然后在 {% span red, powershell %} 窗口中依次键入如下命令检查环境是否符合要求
{% endnote %}

```POWERSHELL
git -v # 查看git版本
pip -V # 查看pip版本
```

{% note success no-icon %}
如果出现如下情况，就表明没有安装{% span red, git %}与{% span red, pip %}：
{% endnote %}

![fig](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/zhenxun_1.png)

{% note success no-icon %}
如果是类似如下的情况就表示环境符合要求，直接跳过本节即可：
{% endnote %}

![fig](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/zhenxun_2.png)

{% note success no-icon %}
下面介绍如何安装{% span red, git %}与{% span red, pip %}
{% endnote %}

#### 1.1.1 git安装

{% note success no-icon %}
访问{% span red, Git %}[下载页](https://git-scm.com/download/win),{% nota 选择适合自己系统的安装包, 我的系统是64位的，所以我这里选的 64-bit Git for Windows Setup %}。
{% endnote %}

![fig](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/zhenxun_git.png)

{% note success no-icon %}
下载完成后，如果不限麻烦可以自行配置安装，嫌麻烦或者不知道怎么整一路点击 {% span blue, next %} 即可，最后点击 {% span blue, finish %}即可完成安装。
{% endnote %}

#### 1.1.2 python安装

{% note warning flat %}
版本警告
真寻Bot需要python环境为 python3.8 及以上
{% endnote %}
{% note success no-icon %}
访问{% span red, Python %}[下载页](https://www.python.org/downloads/windows/),{% nota 选择适合自己系统的安装包, 我的系统是64位的，我这里选的 3.10.11 Windows installer (64-bit) %}，建议选择{% span red, 3.8.x %} 及以上版本的稳定版安装包。
{% endnote %}

![fig](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/zhenxun_py.png)

{% note success no-icon %}
安装时请勾选{% checkbox blue checked, Add python.exe to PATH %},勾选后安装程序会自动添加 {% span red, python.exe %} 到系统环境变量，如果不勾选就需要自己配置环境变量 {% psw 当然你也可以不设置，只要你不介意每次调用python及相关包时添加一大串路径就行 %} ；然后选择{% span blue, Install Now  %}，等待完成安装即可。
{% endnote %}

![fig](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/zhenxun_py_0.png)

{% note success no-icon %}
安装完成后，调出 {% span red, powershell %} 窗口，键入如下命令检查环境
{% endnote %}

```POWERSHELL
git -v # 查看git版本
pip -V # 查看pip版本
```

{% note success no-icon %}
如果是类似如下的情况就表示环境符合要求
{% endnote %}

![fig](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/zhenxun_2.png)

### 1.2 必需组件安装

{% note info flat %}
为方便后续部署与管理，我建议先新建一个文件夹专门用于存储  文件，本教程作为演示将在桌面新建一个名为{% span red, bot %}的文件夹，其在我电脑的绝对路径为{% span red, [C:\Users\Administrator\Desktop\bot\\] %}，我将其作为部署{% span red, bot %}的{% span red, 根目录 %}，在后文中凡涉及到该目录均以{% span red, **[~\\]** %}代替。
{% endnote %}

#### 1.2.1 无头QQ安装

此处提供三种不同的无头QQ的安装，请依需求选择。

{% tabs, -1%}

<!-- tab go-cqhttp -->
|优点|缺点|
|-----|-----|
|安装配置简单，基于协议实现不需要额外安装QQ客户端，占用资源少，能使用上文列出的全部功能|现在风控严重，几乎不能使用，可能需要配置签名服务器|

{% note warning flat %}
最小建议内存并不是必须的，不过当内存小于最小内存时，较长时间运行bot可能会爆内存导致bot进程被kill！
{% endnote %}
最小建议内存:{% span red, 1GB %}
{% note success no-icon %}
go-cqhttp 是使用OneBot协议实现的无头QQ，接受消息后发往后端处理。
这里介绍两种安装方式，自行决定如何安装。
{% endnote %}

{% tabs, -1 %}

<!-- tab 普通安装 -->

{% note success no-icon %}
普通安装使用windows的.exe文件，请从[Mrs4s / go-cqhttp](https://github.com/Mrs4s/go-cqhttp)的[Release](https://github.com/Mrs4s/go-cqhttp/releases)中下载与你系统对应的最新版本。
如果你不知道自己该下哪一个: 一般下载 {% span red, go-cqhttp_windows_amd64.exe %}即可。
下载完成后，将{% nota go-cqhttp.exe, 为方便叙述，后续 go-cqhttp_windows_amd64.exe 等均重命名为 go-cqhttp %} 移动到{% span red, [~\go-cqhttp\\] %}目录{% psw 没有该目录就新建个 %}。
然后调出 {% span red, cmd %} 窗口，使用{% span red, cd %}命令进入{% span red, [~\go-cqhttp\\] %}目录
{% endnote %}

```CMD
cd ~\go-cqhttp\ # 此处 ~ 应换成你电脑的bot文件夹目录
```

{% note success no-icon %}
进入目录后执行如下命令启动{% span red, go-cqhttp %},然后选择3 (反向 Websocket 通信) ，
初次启动会在当前目录下生成配置文件{% span red, config.yml %}。
{% endnote %}

```CMD
go-cqhttp.exe # 运行当前目录下的"go-cqhttp.exe"，后缀可省略
```

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
在此界面按快捷键{% kbd CTRL %} + {% kbd C %}可终止{% span red, go-cqhttp %}。
然后打开配置文件{% span red, config.yml %}进行编辑，将
{% span red, **universal: ws://your_websocket_universal.server** %}
修改为
{% span red, **universal: ws://127.0.0.1:8080/onebot/v11/ws/** %} {% psw 此处的端口应与bot的监听端口一致 %}
将{% span red, uin %}改为你的想要登陆的{% nota QQ账号, 个人十分不建议用主力账号与新创小号 %}，在{% span red, password %}填入对应{% nota 密码, 个人认为扫码登陆失败率过高，不建议使用 %}。
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
配置完成后就可以再次启动{% span red, go-cqhttp %}了，如果没问题的话你应该能看到如下画面：
在这里我们选择**1.自动提交**
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
然后你会看到一个链接，复制到浏览器里面打开就行，验证完以后，如果你运气好应该就能看到如下画面：
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
按照提示进行验证后大概率就是可以登陆成功了，如果出现了一大串{% span yellow, WARNING  %}，这是{% span red, bot %}还没有启动的缘故，不必管它。然后把这个窗口搁在一边，**不要关闭，关闭后bot将不能正常启动！**。然后就可以进行下一步ffmpeg安装了。
{% endnote %}
{% note danger no-icon %}
如果出现如下报错提示，那么你可能需要配置{% span red, config.yml %}中的{% span blue, sign-server %}签名服务器后再次启动。
若无签名服务器，请自行寻找教程配置，本文不再叙述。
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

<!-- endtab -->

<!-- tab 命令行安装 -->

{% note info flat %}
小tips： 在命令行使用{% span blue, dir %}命令可快速查看当前目录下的文件情况
{% endnote %}

{% note success no-icon %}
首先去[Mrs4s / go-cqhttp](https://github.com/Mrs4s/go-cqhttp)的[Release](https://github.com/Mrs4s/go-cqhttp/releases)中寻找与你系统对应的最新版本的下载链接并复制；
然后然后调出 {% span red, powershell %} 窗口，使用{% span red, cd %}命令进入{% span red, [~\\] %}目录
{% endnote %}

```POWERSHELL
cd ~\go-cqhttp\ # 此处 ~ 应换成你电脑的bot文件夹目录
```

{% note success no-icon %}
然后以使用{% span red, Invoke-WebRequest/iwr %},{% span red, bitsadmin %}等工具下载，解压可用{% span red, Expand-Archive %}。
教程演示电脑系统{% span red, windows 11 x64 %}，故以{% span red, go-cqhttp_windows_amd64 %}版的发行版链接作为演示。
压缩包与可执行文件任选一个下载就行
{% endnote %}

```POWERSHELL
# 此处仅提供几条参考命令，具体参数释义请自行百度/google 

# Invoke-WebRequest/iwr
Invoke-WebRequest -Uri https://github.com/MNTMDEV/bilidown_lite/releases/download/4.2.2/bili_down_chrome.crx -OutFile "go-bilidown.crx" # 
Invoke-WebRequest -Uri https://github.com/Mrs4s/go-cqhttp/releases/download/v1.1.0/go-cqhttp_windows_amd64.zip -OutFile "go-cqhttp.zip" # 

# iwr是Invoke-WebRequest的缩写，是一样的
iwr -Uri https://github.com/Mrs4s/go-cqhttp/releases/download/v1.1.0/go-cqhttp_windows_amd64.exe -OutFile "go-cqhttp.exe"
iwr -Uri https://github.com/Mrs4s/go-cqhttp/releases/download/v1.1.0/go-cqhttp_windows_amd64.zip -OutFile "go-cqhttp.zip"

# bitsadmin
bitsadmin /transfer myDownloadJob /download /priority normal https://github.com/Mrs4s/go-cqhttp/releases/download/v1.1.0/go-cqhttp_windows_amd64.exe [~]\go-cqhttp.exe # 此处的[~]应换成你电脑的bot文件夹目录
bitsadmin /transfer myDownloadJob /download /priority normal https://github.com/Mrs4s/go-cqhttp/releases/download/v1.1.0/go-cqhttp_windows_amd64.zip [~]\go-cqhttp.zip # 此处的[~]应换成你电脑的bot文件夹目录

```

{% note success no-icon %}
创建一个文件夹{% span red, go-cqhttp %}，将下载好的可执行文件或压缩包移入或解压到文件夹{% span red, go-cqhttp %}中：
{% endnote %}

```POWERSHELL
New-Item -ItemType Directory -Path .\go-cqhttp # 在当前目录下创建名为go-cqhttp的子文件夹
move go-cqhttp.exe .\go-cqhttp\ # 将当前目录下的go-cqhttp.exe移动到当前目录下的子文件夹go-cqhttp中

# 如果下载的可执行文件不用执行这一步
Expand-Archive -Path ".\go-cqhttp.zip" -DestinationPath ".\go-cqhttp" # 解压当前目录下的go-cqhttp.zip到当前目录下的子文件夹go-cqhttp
```

{% note success no-icon %}
然后使用使用{% span red, cd %}命令进入{% span red, [~\go-cqhttp\] %}目录
{% endnote %}

```POWERSHELL
cd .\go-cqhttp # 进入当前目录下的子文件夹go-cqhttp
```

{% note success no-icon %}
进入目录后执行如下命令启动{% span red, go-cqhttp %},然后选择3 (反向 Websocket 通信) ，
初次启动会在当前目录下生成配置文件{% span red, config.yml %}。
{% endnote %}

```POWERSHELL
\.go-cqhttp.exe # 运行当前目录下的"go-cqhttp.exe"，后缀可省略
```

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
在此界面按快捷键{% kbd CTRL %} + {% kbd C %}可终止{% span red, go-cqhttp %}。
然后打开配置文件{% span red, config.yml %}进行编辑，将
{% span red, **universal: ws://your_websocket_universal.server** %}
修改为
{% span red, **universal: ws://127.0.0.1:8080/onebot/v11/ws/** %} {% psw 此处的端口应与bot的监听端口一致 %}
将{% span red, uin %}改为你的想要登陆的{% nota QQ账号, 个人十分不建议用主力账号与新创小号 %}，在{% span red, password %}填入对应{% nota 密码, 个人认为扫码登陆失败率过高，不建议使用 %}。
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
配置完成后就可以再次启动{% span red, go-cqhttp %}了，如果没问题的话你应该能看到如下画面：
在这里我们选择**1.自动提交**
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
然后你会看到一个链接，复制到浏览器里面打开就行，验证完以后，如果你运气好应该就能看到如下画面：
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

{% note success no-icon %}
按照提示进行验证后大概率就是可以登陆成功了，如果出现了一大串{% span yellow, WARNING  %}，这是{% span red, bot %}还没有启动的缘故，不必管它。然后把这个窗口搁在一边，**不要关闭，关闭后bot将不能正常启动！**。然后就可以进行下一步ffmpeg安装了。
{% endnote %}
{% note danger no-icon %}
如果出现如下报错提示，那么你可能需要配置{% span red, config.yml %}中的{% span blue, sign-server %}签名服务器后再次启动。
{% endnote %}

[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)

<!-- endtab -->

{% endtabs %}
<!-- endtab -->
<!-- tab napcat -->
|优点|缺点|
|-----|-----|
|轻量，资源占用少，不需要图形界面|需要额外安装QQ客户端，部分功能如“戳一戳”无法使用；NapCat 在线时，你不能使用 PC QQ 客户端实现人机合一，但是可以选择同步登录移动客户端；NapCat 不同于协议实现，是基于 QQ 客户端，QQ 客户端上干不了的事，NapCat >_< 当然也是不行的!|

{% note warning flat %}
最小建议内存并不是必须的，不过当内存小于最小内存时，较长时间运行bot可能会爆内存导致bot进程被kill！
{% endnote %}
最小建议内存:{% span red, 2GB %}
<!-- endtab -->
<!-- tab llonebot -->
|优点|缺点|
|-----|-----|
|你可以使用 PC QQ 客户端实现人机合一；有GUI|需要额外安装QQ客户端，部分功能如“戳一戳”无法使用；要求要有图形界面|

{% note warning flat %}
最小建议内存并不是必须的，不过当内存小于最小内存时，较长时间运行bot可能会爆内存导致bot进程被kill！
{% endnote %}
最小建议内存:{% span red, 4GB %}
<!-- endtab -->
{% endtabs %}

### 2.2 ffmpeg安装

{% note success no-icon %}
因为{% span red, bot %}需要发送语音文件等，需要安装ffmpeg。
这里介绍两种安装方式，自行决定如何安装。
{% endnote %}

{% tabs, -1 %}

<!-- tab 普通安装 -->

{% note success no-icon %}
去[FFmpeg网站](https://www.gyan.dev/ffmpeg/builds/)自行下载合适的压缩包。
下载解压之后为{% span red, ffmpeg %}添加到系统环境变量。
添加完成后在{% span red, powershell %}窗口键入{% span red, ffmpeg %}检查是否完成安装，
如果出现{% span red, ffmpeg %}的版本号就表示安装完成了
{% endnote %}

<!-- endtab -->

<!-- tab 命令行安装 -->

{% note success no-icon %}
在 PowerShell 中，你可以使用 `choco` 包管理器来安装 FFmpeg。`choco` 是一个 Windows 包管理工具，可以方便地安装各种软件包。
首先在确保已安装 Chocolatey（`choco`）{% span red, powershell %}窗口键入{% span red, choco %}检查是否完成安装。如果尚未安装，请在 PowerShell 中运行以下命令来安装 Chocolatey：
{% endnote %}

```POWERSHELL
Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
```

{% note success no-icon %}
在 PowerShell 中运行以下命令来安装 FFmpeg：
{% endnote %}

```POWERSHELL
choco install ffmpeg
```

{% note success no-icon %}
添加完成后在{% span red, powershell %}窗口键入{% span red, ffmpeg %}检查是否完成安装，
如果出现{% span red, ffmpeg %}的版本号就表示安装完成了。
{% endnote %}

<!-- endtab -->

{% endtabs %}

### 2.3 PostgreSQL安装

{% note success no-icon %}
一个关系型数据库，占用比mysql小小小小多了...
目前来看postgresql版本似乎对真寻没有太大影响（指9.0以上），不会影响正常使用。
点击[这里](https://get.enterprisedb.com/postgresql/postgresql-15.1-1-windows-x64.exe)将下载Postgresql-15.1-1版本安装包。
以下是安装过程：
{% endnote %}

{% folding blue, 安装与配置过程 %}

1. 双击安装程序，点击Next
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
2. 选择安装路径（没有特殊情况一般默认即可），继续Next
{% note warring flat %}安装路径请不要出现中文！{% endnote %}
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
3. 去掉Stack Builder即可，不影响使用，Next
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
4. 数据存储路径（没有特殊情况一般默认即可），Next
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
5. 输入postgres用户的密码，例如: zhenxun
{% note warring flat %}为避免后续应密码链接数据库出现问题，本教程凡涉及到密码均使用**zhenxun**{% endnote %}
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
6. 默认端口，Next
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
7. 接下来一路Next直到进入安装
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
8. ✨✨ 安装完成 ✨✨
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
{% note success no-icon %}
配置连接
{% endnote %}
9. 找到安装的pgAdmin，直接启动！
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
{% note success no-icon %}
是英文界面？别急，已[百度](https://www.baidu.com/baidu?tn=monline_3_dg&ie=utf-8&wd=pgadmin4%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%87)
{% endnote %}
10. 左侧栏右键点击Servers后选择Register，在点击服务器
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
11. {% del 随便 %} 起一个响亮的名字
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
12. 填写主机名称/地址，如果是连接远程服务器的话对应的服务器IP，本地的话可以直接填写127.0.0.1
端口就是安装时配置的端口，没有修改的话默认5432
密码就是安装时配置的密码
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
13. ✨✨ 点击保存 ✨✨
左侧栏会出现一头🐘
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
14. 展开🐘🐘
右击数据库，选择创建后点击数据库
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
15. ✨✨ 直接创建！ ✨✨
设置数据库名称后点击保存
[](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/)
{% note success no-icon %}
✨✨ 嗨呀，终于完成Postgresql的数据库配置了，好累呀，火速下一步，安装真寻捏 ✨✨
{% endnote %}
{% endfolding %}

## 3 真寻本体与依赖安装

## 3.1 使用git命令下载真寻源码

git clone真寻源码，即下载真寻源码：

```SHELL
git clone https://ghproxy.com/github.com/HibiKier/zhenxun_bot.git
```

## 3.2 修改相关配置

修改bot管理员账号，将你自己的qq账号改成你希望用来管理你bot的qq：

```SHELL
cd ~/zhenxun_bot && sed -i 's/SUPERUSERS.*/SUPERUSERS=["你自己的qq账号"]/g' .env.dev
```

修改数据库连接命令，如果你没对上面数据库的创建命令作出修改直接运行以下命令：

```SHELL
sed -i 's|bind.*|bind: str = "postgresql://zhenxun:zhenxun@localhost:5432/zhenxun"|g' configs/config.py
```

## 3.3 虚拟环境的配置

有很多人的问题都是出在了这里，zhenxun_bot必须在poetry中运行，这是不可缺少的一环

首先，你得进入虚拟环境：

```BASH
cd ~/zhenxun_bot && poetry shell
```

之后便是真寻的{% bubble 相关依赖的安装 , "建议之后添加插件安装相关依赖时均在虚拟环境安装" ,"#66ccff" %}，使用命令：

```CMAKE
poetry install
```

如果是国内机器，不更换pip的源的话会感觉非常的慢，所以在依赖安装之前可以更换pip源，如果之前已经更换，此处不用执行:

```VIM
sudo pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

Playwright浏览器的安装：

```CMAKE
playwright install chromium
```

 至此，真寻的所有的环境都已经配置完毕，就差最后一步的启动了

3.4 启动zhenxun_bot

再次强调一遍，启动真寻之前确定你进入了虚拟环境，有关虚拟环境的进入（参看3.3）

先进入虚拟环境，再运行真寻：

```SHELL
cd ~/zhenxun_bot && poetry shell
cd ~/zhenxun_bot && python3 bot.py
```

现在将你的Bot邀请到任意群聊即可愉快的玩耍了，发送“详细帮助”就可以看当前Bot所有的功能了~

{% endfolding %}

# 二、在Windows使用{% span red,VMware虚拟机 %}安装

## 2.1 VMware虚拟机安装

### 2.1.1 安装VMware虚拟机软件

本教程使用的虚拟机软件为，VMware Workstation 16 Pro，可前往[官网](https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html)下载，下载安装后会有1个月试用期。也可使用我提供的安装资源（附在文末）。

### 2.1.2 下载系统镜像

本教程使用的系统镜像为Ubuntu 20.04 LTS（可以适当使用Ubuntu 20 较高版本），可以去[官网](https://cn.ubuntu.com/download/desktop)下载，也可使用我提供的安装资源。

### 2.1.3 安装Ubuntu虚拟机

{% folding bule ,安装教程 %}

1. 打开安装好的VM，选择创建新的虚拟机
![步骤1](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/1.png "step 1")

2. 选择自定义（高级）并单击下一步
![步骤2](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/2.png "step 2")

3. 这个界面不需要更改，直接单击下一步
![步骤3](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/3.png "step 3")

4. 选择稍后安装操作系统，之后单击下一步
![步骤4](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/4.png "step 4")

5. 选择客户机操作系统为linux，版本选择你下载的Ubuntu 20.04 LTS镜像相对应的版本，我下载的是64位的，所以选择的是64位的
![步骤5](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/5.png "step 5")

6. 上面那一栏自定义你要安装的虚拟机的名称，下面那一栏是安装位置，默认位置为：C:\Users\你的电脑用户名称\Documents\Virtual Machines
![步骤6](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/6.png "step 6")

7. 这个界面设置设置在虚拟机内虚拟的处理器（CPU）的数量与单个处理器的核心数量，默认为2个CPU，单个CPU只有1核。我设置的是1个CPU，4个核心，具体可视自己情况而定。
![步骤7](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/7.png "step 7")

8. 设置分配给虚拟机的内存大小，依主机内存大小不同，其推荐内存大小不同，建议分配推荐内存大小
![步骤8](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/8.png "step 8")

9. 此页面设置为虚拟机添加的网络连接类型，如果不清楚的话，不用更改，直接点击下一步
![步骤9](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/9.png "step 9")

10. 设置I/O控制器类型，不用更改，直接使用推荐类型即可
![步骤10](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/10.png "step 10")

11. 设置为虚拟机创建的虚拟磁盘类型，亦可直接使用推荐类型
![步骤11](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/11.png "step 11")

12. 这个依自己而定，对小白，我推荐选择创建新的虚拟磁盘
![步骤12](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/12.png "step 12")

13. 为虚拟机分配存储空间，如果图简便可直接单击下一步
![步骤13](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/13.png "step 13")

14. 不用更改，直接单击下一步即可
![步骤14](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/14.png "step 14")

15. 在这个页面，单击自定义硬件
![步骤15](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/15.png "step 15")

16. 单击“新CD/DVD”选项
![步骤16](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/16.png "step 16")

17. 在连接一栏选择使用ISO映像文件，再单击浏览，选择你下载好的Ubuntu映像文件，再点击打开即可。（如果用不到设备中的打印机，推荐将其移除）之后点击关闭，就会回到第15步的页面。
![步骤17](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/17.png "step 17")

18. 点击完成，VM会自动创建客户机（或许会自动开启）
![步骤18](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/18.png "step 18")

19. 点击开启此虚拟机，VM会启动此虚拟机，之后会自动进入安装界面
![步骤19](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/19.png "step 19")

20. 之后出现这个界面，在这个界面请耐心等待加载
![步骤20](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/20.png "step 20")

21. 加载完成后出现如下界面，这是安装界面，选择系统语言，推荐选择英语，再点击Install ubuntu
![步骤21](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/21.png "step 21")

22. 选择键盘布局语言，推荐选择英语
![步骤22](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/22.png "step 22")

23. 推荐选择minimal installation，其他可以不用更改
![步骤23](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/23.png "step 23")

24. 可不用更改任何选项，直接点击install now，弹出的下一个界面亦不用管，直接下一步即可
![步骤24](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/24.png "step 24")

25. 选择你的地区，选择上海即可
![步骤25](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/25.png "step 25")

26. 设置你的账户名称，密码等，设置好后，点击下一步，自动安装，此过程耗时较长，请耐心等待
![步骤26](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/26.png "step 26")

27. 重启虚拟机即可安装完成
![步骤27](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/27.png "step 27")

28. 重启完成，输入密码登录后，弹出的一系列窗口都可以不用管，直接skip或next即可。之后会弹出software update窗口，请先更新，待更新完成后重启即可

{% endfolding %}

### 2.1.4 安装过程中可能出现的问题

1. Ubuntu安装过程中出现蓝屏，卡死等情况，而且重启电脑后再次安装依然出现这个问题：
我的电脑就出现过这种问题，这个或许是因为wsl没有开启，建议开启Windows的wsl后再尝试安装，或许能解决（我的是使用这个方法解决了，其他的不清楚）。别问我为啥不直接用wsl部署，问就是整不来，也没找到具体教程。

2. 在选择键盘语言格式时，选择中文后发现下一步等选项不见了：
这个我也遇到过，不过咱也没有什么特别好的解决方法，只知道选择英语大概率不会出现这种情况，所以我推荐选择英语。

3. 安装Ubuntu时好慢呐，有什么办法能提高访问速度吗：
因为Ubuntu的官方服务器在国外，所以安装得很慢是十分正常的，可以试试在你的电脑上挂个梯子，开全局代理，或许速度会快很多。

4. 安装过程第28步提到了software update，可不可以不用更新：
进行software update是为了能顺利更改镜像源，需完成更新后方可进入更改镜像源的设置。关于更改镜像源有何作用，在后面的安装过程会提及，此处不多赘述。

{% folding bule , wsl开启方法 %}

1. 点击任务栏的Windows图标，在搜索框中输入“启用”/“启用或关闭windows功能”，然后选择“启用或关闭windows功能”
![wsl1](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/wsl1.png " wsl 1")

2. 在弹出的窗口中翻找选项“适用于 Linux 的 Windows 子系统”
![wsl2](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/wsl2.png " wsl 2 ")

3. 勾选“适用于 Linux 的 Windows 子系统”选项，点击确定后重启电脑即可
![wsl3](https//cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/wsl3.png " wsl 3 ")

{% endfolding %}

## 2.2 python 与 ffmpeg 等前置组件安装

从最开始的纯净的**Ubuntu20.04**系统开始部署，**Ubuntu20.04**自带有**python3.8.10**所以避免了不太友好的**python3.8**或者**python3.9**的安装。当然，如果你是别的系统，也可以百度搜索 【{你的系统和版本}**python3.8**安装】。所以为了避免一系列因为系统不相同而导致的问题，推荐使用纯净的**Ubuntu20.04**系统部署真寻。

首先，在Ubuntu桌面，使用快捷键：CTRL+ALT+T可以terminal终端，从而进行命令行的输入。

然后依次执行下面的命令

因zhenxun_bot项目使用了语音文件等，该音频需要依赖ffmpeg

```SHELL
 sudo apt update && sudo apt install -y wget git screen ffmpeg # 安装ffmpeg
```

```SHELL
 sudo apt update && sudo apt install -y python3-pip # 安装pip
```

{% note info flat %}安装pip后，如果觉得使用pip下载poetry太慢的话，可以试试换到清华源（注意要把pip安装完成后再换源）{% endnote %}

```SHELL
 sudo pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple 
```

新版真寻使用的{% bubble poetry , 新版真寻将依赖安装在poetry虚拟环境里，在环境配置出现错误时只需删除对应的poetry包即可，不需要回滚系统 ,blue %}虚拟环境安装，所以需要安装poetry，安装命令如下：

```SHELL
sudo pip install poetry # 安装poetry
```

## 2.3 PostgreSQL数据库的安装

据了解 PostgreSQL 数据库的版本在9.0以上即可，版本的不同并不会对真寻的运行造成影响，所以这里使用的是PostgreSQL12，以下命令注意要一行一行运行.

PostgreSQL安装命令：

```SHELL
sudo apt update && sudo apt install -y postgresql postgresql-contrib
```

```SHELL
sudo su - postgres
psql
CREATE USER zhenxun WITH PASSWORD 'zxpassword'; # 创建一个用户“zhenxun”，用户密码为“zxpassword”
CREATE DATABASE zhenxun OWNER zhenxun; # 为用户“zhenxun”创建一个数据库“zhenxun”
exit;
exit
```

exit命令需要运行两次来退出数据库

## 2.4 一些必要的依赖

真寻运行所需要的的系统相关依赖的安装：

```SHELL
sudo apt install -y \
    libgl1 \
    libglib2.0-0 \
    libnss3 \
    libatk1.0-0 \
    libatk-bridge2.0-0 \
    libcups2 \
    libxkbcommon0 \
    libxcomposite1 \
    libxrandr2 \
    libgbm1 \
    libgtk-3-0 \
    libasound2  
    # 整段复制运行
```

Ubuntu安装中文字体

```SHELL
sudo apt-get install -y ttf-wqy-zenhei ttf-wqy-microhei fonts-arphic-ukai fonts-arphic-uming
sudo fc-cache -f -v
```

{% note warning flat %}新版QQ使用go-cqhttp被ban风险极大，本教程已弃用, 请使用其他无头QQ如[NapCat](https://napneko.github.io/zh-CN/)等{% endnote %}

# 三、go-cqhttp的安装

go-cqhttp的简要说明：
go-cqhttp是使用OneBot协议实现的无头QQ，接受消息发往后端处理，详细参见[项目地址](https://github.com/Mrs4s/go-cqhttp)

## 3.1 下载go-cqhttp

下载go-cqhttp需要wget组件，运行如下命令安装：

```SHELL
sudo apt install -y wget
```

再装go-cqhttp，整段复制：

```SHELL
mkdir ~/go-cqhttp && \
    cd ~/go-cqhttp && \
    wget https://github.com/Mrs4s/go-cqhttp/releases/download/v1.0.1/go-cqhttp_linux_amd64.tar.gz -O go-cqhttp_linux_amd64.tar.gz && \
    tar -zxvf go-cqhttp_linux_amd64.tar.gz
```

go-cqhttp 的版本可自己调节，此处使用的是v1.0.1

## 3.2  修改相关配置

运行一次go-cqhttp

```SHELL
cd ~/go-cqhttp && echo -e "3\n" | ./go-cqhttp
```

首次运行会出现以下界面
![go-cqhttp](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/28.png " go-cqhttp ")

之后输入命令修改配置

```SHELL
sudo sed -i 's|universal:.*|universal: ws://localhost:8084/onebot/v11/ws|g' config.yml
```

或者修改/root/go-cqhttp/config.yml，将universal参数改成ws://127.0.0.1:8080/onebot/v11/ws/并保存

## 3.3  go-cqhttp的持久化运行

持久化运行go-cqhttp，推荐使用screen，方便管理适合新手，screen的安装命令：

```SHELL
sudo apt install -y screen
```

安装完成以后创建screen并进入：

```SHELL
screen -S go-cqhttp 
```

在重新出现的shell界面，运行go-cqhttp并扫描二维码登陆bot的qq，待命：
注：建议在执行此条命令前先将终端调至全屏

```SHELL
cd ~/go-cqhttp && echo -e "3\n" | ./go-cqhttp -faststart
```

之后出现二维码以后，扫码登陆
![二维码](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/29.png " 二维码 ")

之后出现以下信息为正常登陆成功，然后使用 Ctrl + A + D 组合键退出screen
注：使用 Ctrl + A + D 组合键退出screen，screen并未完全退出，仍在后台运行go-cqhttp，请不要尝试强制阻止其运行，否则会导致bot无法正常启动
![yunxin](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/30.png  " yunxing ")

至此，go-cqhttp的部署完成了，接下来便是真寻本体的部署

# 四、zhenxun_bot的部署

## 4.1 下载zhenxun_bot源码

使用git命令下载真寻源码，需要先行安装git，运行：

```SHELL
sudo apt install -y git
```

git clone真寻源码，即下载真寻源码：

```SHELL
cd && git clone https://ghproxy.com/github.com/HibiKier/zhenxun_bot.git
```

## 4.2 修改相关配置

修改bot管理员账号，将你自己的qq账号改成你希望用来管理你bot的qq：

```SHELL
cd ~/zhenxun_bot && sed -i 's/SUPERUSERS.*/SUPERUSERS=["你自己的qq账号"]/g' .env.dev
```

修改数据库连接命令，如果你没对上面数据库的创建命令作出修改直接运行以下命令：

```SHELL
sed -i 's|bind.*|bind: str = "postgres://zhenxun:zxpassword@localhost:5432/zhenxun"|g' configs/config.py
```

## 4.3 虚拟环境的配置

有很多人的问题都是出在了这里，zhenxun_bot必须在poetry中运行，这是不可缺少的一环

首先，你得进入虚拟环境：

```BASH
cd ~/zhenxun_bot && poetry shell
```

之后便是真寻的{% bubble 相关依赖的安装 , "建议之后添加插件安装相关依赖时均在虚拟环境安装" ,"#66ccff" %}，使用命令：

```CMAKE
poetry install
```

如果是国内机器，不更换pip的源的话会感觉非常的慢，所以在依赖安装之前可以更换pip源，如果之前已经更换，此处不用执行:

```VIM
sudo pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

Playwright浏览器的安装：

```CMAKE
playwright install chromium
```

如果不想启动后下载一大堆资源，可以执行以下命令，下载相关资源
整段复制运行

```SHELL
SOURCE_URL=https://pan.yropo.top/source/zhenxun/
wget ${SOURCE_URL}data_draw_card.tar.gz -qO ~/.cache/data_draw_card.tar.gz \
    && wget ${SOURCE_URL}img_draw_card.tar.gz -qO ~/.cache/img_draw_card.tar.gz \
    && tar -zxvf ~/.cache/data_draw_card.tar.gz -C ~/zhenxun_bot/ \
    && tar -zxvf ~/.cache/img_draw_card.tar.gz -C ~/zhenxun_bot/ \
    && rm -rf ~/.cache/*.tar.gz
```

 至此，真寻的所有的环境都已经配置完毕，就差最后一步的启动了

3.4 启动zhenxun_bot

再次强调一遍，启动真寻之前确定你进入了虚拟环境，有关虚拟环境的进入（参看3.3）

当然，启动之前我们得让真寻一直跑着，所以我们需要用到screen来让真寻持久化运行

```SHELL
screen -S zhenxun
```

然后先进入虚拟环境，再运行真寻：

```SHELL
cd ~/zhenxun_bot && poetry shell
cd ~/zhenxun_bot && python3 bot.py
```

按Ctrl+A+D组合键挂起screen
现在将你的Bot邀请到任意群聊即可愉快的玩耍了，发送“详细帮助”就可以看当前Bot所有的功能了~

## 4.5 管理相关

真寻的安装目录位于 ~/zhenxun_bot 下

go-cqhttp的安装目录位于 ~/go-cqhttp 下

进入真寻的screen界面命令：

```SHELL
screen -r zhenxun
screen -X -S zhenxun quit #强制结束zhenxun窗口
```

进入go-cqhttp界面的命令：

```SHELL
screen -r go-cqhttp
screen -X -S go-cqhttp quit #强制结束go-cqhttp窗口
```

## 4.6 杂七杂八的错误

1. 反向链接失败
![fanxiang](https://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/fx.png " fx ")

如果运行bot后提示反向链接失败，说明go-cqhttp配置错了，仔细检查

2. 提示更改设置后自动退出

第一次运行可能会提示修改配置文件，这里可以修改/root/zhenxun_bot/configs/config.yaml，内容自定，也可以不修改直接再次运行命令python3 bot.py启动bot

3. 关闭bot后如何重新启动

如果是在terminal终端界面使用 CTRL + C 退出了bot运行，直接运行下面的命令：

```SHELL
cd ~/zhenxun_bot && python3 bot.py
```

如果已经关闭了terminal终端，再次打开terminal终端，为启动bot请逐条执行下面的命令
：

```SHELL
screen -S go-cqhttp #创建screen
cd ~/go-cqhttp && echo -e "3\n" | ./go-cqhttp -faststart #运行
```

按下{% kbd CTRL %} + {% kbd A %} + {% kbd D %} 挂起{% span blue, go-cqhttp %}screen。

```SHELL
screen -S zhenxun #创建screen
cd ~/zhenxun_bot && poetry shell #进入虚拟环境
cd ~/zhenxun_bot && python3 bot.py #启动bot
```

## 4.7 安装插件

绪山真寻Bot提供了官方的插件库，[点此跳转](https://github.com/zhenxun-org/nonebot_plugins_zhenxun_bot)
![chajian](http://cdn.hatsusakuramiku.cn/hexo/img/post/zhenxun/cj.png " cj ")

安装方法也很简单，直接将插件文件夹拖到/root/zhenxun_bot/plugins目录下，然后重启bot即可
需要注意的是，部分插件需要安装依赖，也有部分插件存在兼容问题无法使用，自行甄别

提一句，需要安装依赖的插件其目录里一般会有“requirements.txt”，请在插件下载完成后，打开插件的文件夹，鼠标右键点击空白处，选择打开terminal终端，在这个终端中执行安装依赖的命令
否则会出错，无法正常安装依赖

# {% psw 抄的 %}参考文章

1. [领养一只可爱的小真寻—绪山真寻Bot部署教程](https://www.smoe.top/2022/03/25/zhenxun-bot-deploy/)--小小黑

2. [【zhenxun_bot】可爱的绪山真寻Bot部署教程](https://www.smoe.top/2022/03/25/zhenxun-bot-deploy/)--Sakura

# 安装资源

1. VMware Workstation：百度网盘：链接：<https://pan.baidu.com/s/1_ACWmWUe7iP5ool-ctz7Gg?pwd=x7h4>

2. Ubuntu：官方下载：Ubuntu 20.04.4 LTS (Focal Fossa)
Ubuntu 20.04 LTS desktop x64 [磁力链](magnet:?xt=urn:btih:F09C8D0884590088F4004E010A928F8B6178C2FD&dn=ubuntu-20.04.4-desktop-amd64.iso&tr=https%3a%2f%2ftorrent.ubuntu.com%2fannounce&tr=https%3a%2f%2fipv6.torrent.ubuntu.com%2fannounce)
